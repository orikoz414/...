from google.colab import drive
drive.mount('/content/drive')  # ‚ö†Ô∏è –ü–æ–¥–∫–ª—é—á–∞–µ–º Google Drive –≤ Colab - –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.ensemble import RandomForestClassifier  # ‚ö†Ô∏è –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
from sklearn.model_selection import train_test_split  # ‚ö†Ô∏è –î–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏
import os
import kagglehub  # ‚ö†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ —Å Kaggle

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
plt.rcParams['font.size'] = 12
plt.rcParams['axes.titlesize'] = 14
sns.set_style("whitegrid")  # ‚ö†Ô∏è –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª—å –≥—Ä–∞—Ñ–∏–∫–æ–≤ seaborn

def download_kaggle_dataset():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç —Å Kaggle."""
    try:
        # ‚ö†Ô∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞—Ç–∞—Å–µ—Ç –ø–æ –µ–≥–æ –∏–º–µ–Ω–∏ - –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è API –∫–ª—é—á Kaggle
        path = kagglehub.dataset_download("nabeelqureshitiii/student-performance-dataset")
        
        # ‚ö†Ô∏è –ò—â–µ–º –≤—Å–µ CSV —Ñ–∞–π–ª—ã –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –ø–∞–ø–∫–µ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥)
        csv_files = []
        for root, dirs, files in os.walk(path):  # os.walk –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º –ø–∞–ø–∫–∞–º
            for file in files:
                if file.endswith('.csv'):  # –ò—â–µ–º —Ç–æ–ª—å–∫–æ CSV —Ñ–∞–π–ª—ã
                    csv_files.append(os.path.join(root, file))  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å
        
        if not csv_files:
            return None  # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ CSV —Ñ–∞–π–ª–æ–≤
        
        # ‚ö†Ô∏è –ß–∏—Ç–∞–µ–º –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π CSV —Ñ–∞–π–ª –≤ DataFrame
        df = pd.read_csv(csv_files[0])
        return df
        
    except Exception as e:
        return None  # ‚ö†Ô∏è –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None


def prepare_training_data_from_kaggle(df):
    """–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞ Kaggle."""
    if df is None or len(df) == 0:
        return None  # ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—É—Å—Ç—ã–µ
    
    # ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤ –¥–∞–Ω–Ω—ã—Ö
    attendance_keywords = ['attendance', 'attend', 'presence', 'percentage', '%']
    grade_keywords = ['grade', 'score', 'mark', 'gpa', 'average', 'avg']
    
    # ‚ö†Ô∏è –ü–æ–∏—Å–∫ –∫–æ–ª–æ–Ω–æ–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (—Ä–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω - lower())
    attendance_cols = [col for col in df.columns if any(keyword in col.lower() for keyword in attendance_keywords)]
    grade_cols = [col for col in df.columns if any(keyword in col.lower() for keyword in grade_keywords)]
    
    # ‚ö†Ô∏è –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –∫–æ–ª–æ–Ω–∫—É –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏
    attendance_col = attendance_cols[0] if attendance_cols else None
    grade_col = grade_cols[0] if grade_cols else None
    
    training_data = []
    specialties = ['—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ', '–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–æ–µ', '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ', '–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–µ', '—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ']
    
    num_samples = min(350, len(df))  # ‚ö†Ô∏è –ë–µ—Ä–µ–º –º–∞–∫—Å–∏–º—É–º 350 –∑–∞–ø–∏—Å–µ–π –∏–ª–∏ –≤—Å–µ –µ—Å–ª–∏ –º–µ–Ω—å—à–µ
    
    for i in range(num_samples):
        row = df.iloc[i]  # ‚ö†Ô∏è –ü–æ–ª—É—á–∞–µ–º i-—é —Å—Ç—Ä–æ–∫—É DataFrame
        
        # 1. –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
        if attendance_col and pd.notna(row[attendance_col]):  # ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ NaN
            attendance_val = float(row[attendance_col])
            if 0 <= attendance_val <= 1:  # ‚ö†Ô∏è –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç 0 –¥–æ 1 (–¥–æ–ª—è)
                attendance = attendance_val * 100  # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
            elif attendance_val > 100:  # ‚ö†Ô∏è –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –±–æ–ª—å—à–µ 100
                attendance = min(attendance_val / 10, 100)  # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º
            else:
                attendance = min(max(attendance_val, 0), 100)  # ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ç 0 –¥–æ 100
        else:
            attendance = np.random.randint(60, 96)  # ‚ö†Ô∏è –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
        
        # 2. –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞
        if grade_col and pd.notna(row[grade_col]):
            grade_val = float(row[grade_col])
            if grade_val > 5:  # ‚ö†Ô∏è –ï—Å–ª–∏ 100-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
                avg_grade = 2.0 + (grade_val / 100 * 3.0)  # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ 5-–±–∞–ª–ª—å–Ω—É—é
            else:
                avg_grade = min(max(grade_val, 2.0), 5.0)  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ç 2.0 –¥–æ 5.0
        else:
            avg_grade = np.random.uniform(2.0, 5.0)  # ‚ö†Ô∏è uniform –¥–∞–µ—Ç –¥—Ä–æ–±–Ω—ã–µ —á–∏—Å–ª–∞
        
        # 3. –í–Ω–µ—É—á–µ–±–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å
        extracurricular = np.random.choice([0, 1])  # ‚ö†Ô∏è –°–ª—É—á–∞–π–Ω–æ 0 –∏–ª–∏ 1
        
        # 4. –ú–æ—Ç–∏–≤–∞—Ü–∏—è (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ—Ü–µ–Ω–∫–∏)
        motivation = int(3 + (avg_grade - 2.0) * (7 / 3.0))  # ‚ö†Ô∏è –§–æ—Ä–º—É–ª–∞: —á–µ–º –≤—ã—à–µ –æ—Ü–µ–Ω–∫–∞, —Ç–µ–º –≤—ã—à–µ –º–æ—Ç–∏–≤–∞—Ü–∏—è
        
        # 5. –û–ø–æ–∑–¥–∞–Ω–∏—è (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏)
        late_count = int((100 - attendance) / 15)  # ‚ö†Ô∏è –§–æ—Ä–º—É–ª–∞: —á–µ–º –Ω–∏–∂–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å, —Ç–µ–º –±–æ–ª—å—à–µ –æ–ø–æ–∑–¥–∞–Ω–∏–π
        
        # 6. –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ (–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞)
        if attendance > 85 and avg_grade > 4.0:
            specialty = '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ'  # ‚ö†Ô∏è –í—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        elif avg_grade > 3.5 and extracurricular == 1:
            specialty = '–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–æ–µ'
        elif motivation > 7:
            specialty = '—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ'
        elif late_count > 5:
            specialty = '—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ'
        else:
            specialty = np.random.choice(specialties)  # ‚ö†Ô∏è –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞
        
        # ‚ö†Ô∏è –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ —Å–ø–∏—Å–æ–∫
        training_data.append({
            'attendance': attendance,
            'avg_grade': avg_grade,
            'extracurricular': extracurricular,
            'motivation': motivation,
            'late_count': late_count,
            'specialty': specialty
        })
    
    return pd.DataFrame(training_data)  # ‚ö†Ô∏è –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π –≤ DataFrame


def get_specialty_info(choice):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏."""
    # ‚ö†Ô∏è –°–ª–æ–≤–∞—Ä—å –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ —á–∏—Å–µ–ª –≤ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
    specialties = {
        1: '—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ',
        2: '–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–æ–µ',
        3: '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ',
        4: '–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–µ',
        5: '—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ'
    }
    
    # ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    typical_values = {
        '—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ': (82.0, 3.8, 6, 3),  # (–ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å, –æ—Ü–µ–Ω–∫–∞, –º–æ—Ç–∏–≤–∞—Ü–∏—è, –æ–ø–æ–∑–¥–∞–Ω–∏—è)
        '–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–æ–µ': (85.0, 4.0, 7, 2),
        '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ': (88.0, 4.3, 8, 1),
        '–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–µ': (84.0, 3.9, 7, 2),
        '—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ': (80.0, 3.7, 6, 4)
    }
    
    if choice not in specialties:  # ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–≤–æ–¥–∞
        raise ValueError("–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 5")
    
    specialty = specialties[choice]  # ‚ö†Ô∏è –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ —á–∏—Å–ª—É
    # ‚ö†Ô∏è –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∫–æ—Ä—Ç–µ–∂ –∑–Ω–∞—á–µ–Ω–∏–π
    typical_att, typical_grade, typical_motiv, typical_late = typical_values[specialty]
    
    return specialty, typical_att, typical_grade, typical_motiv, typical_late


def validate_input(attendance, avg_grade, motivation, late_count, extracurricular):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""
    # ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π
    if not (0 <= attendance <= 100):
        raise ValueError("–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 100")
    if not (2.0 <= avg_grade <= 5.0):
        raise ValueError("–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ –æ—Ç 2.0 –¥–æ 5.0")
    if motivation < 1 or motivation > 10:
        raise ValueError("–ú–æ—Ç–∏–≤–∞—Ü–∏—è –æ—Ç 1 –¥–æ 10")
    if late_count < 0:
        raise ValueError("–û–ø–æ–∑–¥–∞–Ω–∏—è –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏")
    if extracurricular not in [0, 1]:  # ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ 0 –∏–ª–∏ 1
        raise ValueError("–í–Ω–µ—É—á–µ–±–∫–∞: 1 ‚Äî –¥–∞, 0 ‚Äî –Ω–µ—Ç")


def create_visualizations(results, n_new):
    """–°–æ–∑–¥–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞."""
    fig, axes = plt.subplots(2, 2, figsize=(15, 10))  # ‚ö†Ô∏è –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É 2x2 –≥—Ä–∞—Ñ–∏–∫–æ–≤
    fig.suptitle(f"–ê–ù–ê–õ–ò–ó –£–°–ü–ï–í–ê–ï–ú–û–°–¢–ò: {n_new} –°–¢–£–î–ï–ù–¢–û–í", fontsize=16, weight='bold')
    
    # 1. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (–∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)
    status_counts = results['–°—Ç–∞—Ç—É—Å'].value_counts()  # ‚ö†Ô∏è –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
    colors = ['#4CAF50' if status == '—É—Å–ø–µ—à–Ω—ã–π' else '#FF9800' for status in status_counts.index]
    axes[0, 0].pie(status_counts.values, labels=status_counts.index, autopct='%1.1f%%',
                   colors=colors, startangle=90)
    axes[0, 0].set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º")
    
    # 2. –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º
    if len(results['–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ'].unique()) > 1:  # ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
        # ‚ö†Ô∏è –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –∏ –≤—ã—á–∏—Å–ª—è–µ–º –¥–æ–ª—é —É—Å–ø–µ—à–Ω—ã—Ö
        specialty_performance = results.groupby('–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ')['–°—Ç–∞—Ç—É—Å'].apply(
            lambda x: (x == '—É—Å–ø–µ—à–Ω—ã–π').mean()  # ‚ö†Ô∏è lambda —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ
        ).sort_values(ascending=False)  # ‚ö†Ô∏è –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
        
        colors_spec = ['#2196F3', '#4CAF50', '#FF9800', '#9C27B0', '#795548']
        specialty_performance.plot(kind='bar', ax=axes[0, 1], color=colors_spec, alpha=0.8)
        axes[0, 1].set_title("–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º")
        axes[0, 1].set_ylabel("–î–æ–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤")
        axes[0, 1].tick_params(axis='x', rotation=45)
    else:
        axes[0, 1].text(0.5, 0.5, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π\n–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è', 
                       ha='center', va='center', fontsize=12)
        axes[0, 1].set_title("–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º")
    
    # 3. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞)
    if n_new > 0:
        axes[1, 0].hist(results['–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å'], bins=10, color='#2196F3', alpha=0.7, edgecolor='black')
        axes[1, 0].axvline(results['–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å'].mean(), color='red', linestyle='dashed', linewidth=1)
        axes[1, 0].set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏")
        axes[1, 0].set_xlabel("–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å (%)")
        axes[1, 0].set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤")
        axes[1, 0].grid(True, alpha=0.3)
    
    # 4. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞)
    if n_new > 0:
        axes[1, 1].hist(results['–°—Ä_–æ—Ü–µ–Ω–∫–∞'], bins=10, color='#4CAF50', alpha=0.7, edgecolor='black')
        axes[1, 1].axvline(results['–°—Ä_–æ—Ü–µ–Ω–∫–∞'].mean(), color='red', linestyle='dashed', linewidth=1)
        axes[1, 1].set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫")
        axes[1, 1].set_xlabel("–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞")
        axes[1, 1].set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤")
        axes[1, 1].grid(True, alpha=0.3)
    
    plt.tight_layout()  # ‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
    plt.show()


def print_recommendations(results, n_new):
    """–í—ã–≤–æ–¥–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞."""
    # ‚ö†Ô∏è –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –≥—Ä—É–ø–ø–µ —Ä–∏—Å–∫–∞
    at_risk_count = (results['–°—Ç–∞—Ç—É—Å'] == '–≤ –≥—Ä—É–ø–ø–µ —Ä–∏—Å–∫–∞').sum()
    
    print(f"\nüìà –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:")
    print(f"–í—Å–µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: {n_new} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤")
    print(f"–í –≥—Ä—É–ø–ø–µ —Ä–∏—Å–∫–∞: {at_risk_count} ({at_risk_count/n_new:.1%})")  # ‚ö†Ô∏è –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
    
    print(f"\nüéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:")
    
    if at_risk_count == 0:
        print("‚úÖ –û—Ç–ª–∏—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏! –í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Å–≤–∞–∏–≤–∞—é—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É.")
        return
    
    print(f"‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ {at_risk_count} —Å—Ç—É–¥–µ–Ω—Ç—É(–∞–º):")
    
    # ‚ö†Ô∏è –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –≥—Ä—É–ø–ø–µ —Ä–∏—Å–∫–∞
    risk_students = results[results['–°—Ç–∞—Ç—É—Å'] == '–≤ –≥—Ä—É–ø–ø–µ —Ä–∏—Å–∫–∞']
    
    for idx, student in risk_students.iterrows():  # ‚ö†Ô∏è –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ DataFrame
        print(f"\n   üë§ {student['–°—Ç—É–¥–µ–Ω—Ç']} ({student['–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ']}):")
        issues = []  # ‚ö†Ô∏è –°–ø–∏—Å–æ–∫ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–±–ª–µ–º
        if student['–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å'] < 75:
            issues.append(f"–Ω–∏–∑–∫–∞—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å ({student['–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å']:.1f}%)")
        if student['–°—Ä_–æ—Ü–µ–Ω–∫–∞'] < 3.5:
            issues.append(f"–Ω–∏–∑–∫–∞—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å ({student['–°—Ä_–æ—Ü–µ–Ω–∫–∞']:.2f})")
        if student['–û–ø–æ–∑–¥–∞–Ω–∏—è'] > 4:
            issues.append(f"—á–∞—Å—Ç—ã–µ –æ–ø–æ–∑–¥–∞–Ω–∏—è ({student['–û–ø–æ–∑–¥–∞–Ω–∏—è']})")
        if student['–í–Ω–µ—É—á–µ–±–∫–∞'] == '–ù–µ—Ç':
            issues.append("–Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤–æ –≤–Ω–µ—É—á–µ–±–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏")
        
        if issues:
            print(f"      ‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã: {', '.join(issues)}")  # ‚ö†Ô∏è –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –≤ —Å—Ç—Ä–æ–∫—É
        else:
            print(f"      ‚Ä¢ –û–±—â–∞—è –Ω–∏–∑–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è")


# ==================== –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê ====================

print("üéì –°–ò–°–¢–ï–ú–ê –ê–ù–ê–õ–ò–ó–ê –£–°–ü–ï–í–ê–ï–ú–û–°–¢–ò –°–¢–£–î–ï–ù–¢–û–í")

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞—Ç–∞—Å–µ—Ç —Å Kaggle
raw_data = download_kaggle_dataset()

# –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
if raw_data is not None:
    data = prepare_training_data_from_kaggle(raw_data)
else:
    # ‚ö†Ô∏è –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å - —Å–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
    specialties = ['—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ'] * 70 + ['–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–æ–µ'] * 70 + \
                  ['–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ'] * 70 + ['–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–µ'] * 70 + \
                  ['—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ'] * 70  # ‚ö†Ô∏è –°–ø–∏—Å–æ–∫ –∏–∑ 350 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    
    demo_data = []
    for i in range(350):
        demo_data.append({
            'attendance': np.random.randint(60, 96),
            'avg_grade': np.random.uniform(2.0, 5.0),
            'extracurricular': np.random.choice([0, 1]),
            'motivation': np.random.randint(3, 11),
            'late_count': np.random.randint(0, 10),
            'specialty': specialties[i % len(specialties)]  # ‚ö†Ô∏è –¶–∏–∫–ª–∏—á–µ—Å–∫–∏ –±–µ—Ä–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        })
    
    data = pd.DataFrame(demo_data)  # ‚ö†Ô∏è –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ DataFrame

# ‚ö†Ô∏è –†–∞—Å—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ
performance_score = (
    data['attendance'] * 0.3 +
    data['avg_grade'] * 15 +
    data['motivation'] * 2 +
    data['extracurricular'] * 3 -
    data['late_count'] * 1.2
)

# ‚ö†Ô∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä–æ–≥ —Ä–∏—Å–∫–∞ –∫–∞–∫ 25-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å (–Ω–∏–∂–Ω–∏–µ 25%)
risk_threshold = performance_score.quantile(0.25)
# ‚ö†Ô∏è –°–æ–∑–¥–∞–µ–º –±–∏–Ω–∞—Ä–Ω—É—é —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω—É: 1 –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω—ã–π, 0 –µ—Å–ª–∏ –≤ —Ä–∏—Å–∫–µ
data['performance'] = (performance_score > risk_threshold).astype(int)

print(f"üìä –û–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö: {len(data)} –∑–∞–ø–∏—Å–µ–π")

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
# ‚ö†Ô∏è –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ (X) –∏ —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (y)
X = data[['attendance', 'avg_grade', 'extracurricular', 'motivation', 'late_count']]
y = data['performance']

# ‚ö†Ô∏è –†–∞–∑–¥–µ–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ: 80% –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ, 20% –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# ‚ö†Ô∏è –°–æ–∑–¥–∞–µ–º –∏ –æ–±—É—á–∞–µ–º –º–æ–¥–µ–ª—å Random Forest
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# ‚ö†Ô∏è –û—Ü–µ–Ω–∏–≤–∞–µ–º —Ç–æ—á–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
accuracy = model.score(X_test, y_test)
print(f"‚úÖ –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞. –¢–æ—á–Ω–æ—Å—Ç—å: {accuracy:.1%}")

# –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
print("\n" + "=" * 60)
print("üìä –ê–ù–ê–õ–ò–ó –ù–û–í–´–• –°–¢–£–î–ï–ù–¢–û–í")
print("=" * 60)

try:
    n_new = int(input("\n–°–∫–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å? "))
    if n_new <= 0:
        raise ValueError("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ –Ω—É–ª—è.")
    
    new_students = []
    
    for i in range(n_new):
        print(f"\nüë§ –°—Ç—É–¥–µ–Ω—Ç {i + 1}")
        print("-" * 30)
        
        print("\n–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏:")
        print("1 - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ")
        print("2 - –ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–æ–µ")
        print("3 - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ")
        print("4 - –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–µ")
        print("5 - –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ")
        
        choice = int(input("–í–∞—à –≤—ã–±–æ—Ä (1-5): "))
        
        specialty, typical_att, typical_grade, typical_motiv, typical_late = get_specialty_info(choice)
        
        # ‚ö†Ô∏è –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        attendance = float(input(f"–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å (%) [—Å—Ä–µ–¥–Ω–µ–µ {typical_att}]: ") or typical_att)
        avg_grade = float(input(f"–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ [—Å—Ä–µ–¥–Ω–µ–µ {typical_grade}]: ") or typical_grade)
        motivation = int(input(f"–ú–æ—Ç–∏–≤–∞—Ü–∏—è (1-10) [—Å—Ä–µ–¥–Ω–µ–µ {typical_motiv}]: ") or typical_motiv)
        late_count = int(input(f"–û–ø–æ–∑–¥–∞–Ω–∏–π –∑–∞ —Å–µ–º–µ—Å—Ç—Ä [—Å—Ä–µ–¥–Ω–µ–µ {typical_late}]: ") or typical_late)
        extracurricular = int(input("–£—á–∞—Å—Ç–≤—É–µ—Ç –≤–æ –≤–Ω–µ—É—á–µ–±–∫–µ? (1 ‚Äî –¥–∞, 0 ‚Äî –Ω–µ—Ç): "))
        
        validate_input(attendance, avg_grade, motivation, late_count, extracurricular)
        
        new_students.append([attendance, avg_grade, extracurricular, motivation, late_count, specialty])
    
    # ‚ö†Ô∏è –°–æ–∑–¥–∞–µ–º DataFrame –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    new_students_df = pd.DataFrame({
        'attendance': [s[0] for s in new_students],
        'avg_grade': [s[1] for s in new_students],
        'extracurricular': [s[2] for s in new_students],
        'motivation': [s[3] for s in new_students],
        'late_count': [s[4] for s in new_students]
    })
    
    # ‚ö†Ô∏è –ü–æ–ª—É—á–∞–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∞—Å—Å—É 1 (—É—Å–ø–µ—à–Ω—ã–π)
    probabilities = model.predict_proba(new_students_df)[:, 1]
    # ‚ö†Ô∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ (–ø–æ—Ä–æ–≥ 0.5)
    statuses = ["—É—Å–ø–µ—à–Ω—ã–π" if p >= 0.5 else "–≤ –≥—Ä—É–ø–ø–µ —Ä–∏—Å–∫–∞" for p in probabilities]
    
    # ‚ö†Ô∏è –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    results = pd.DataFrame({
        '–°—Ç—É–¥–µ–Ω—Ç': [f"–°—Ç—É–¥–µ–Ω—Ç {i+1}" for i in range(n_new)],
        '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ': [s[5] for s in new_students],
        '–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å': new_students_df['attendance'],
        '–°—Ä_–æ—Ü–µ–Ω–∫–∞': new_students_df['avg_grade'],
        '–ú–æ—Ç–∏–≤–∞—Ü–∏—è': new_students_df['motivation'],
        '–û–ø–æ–∑–¥–∞–Ω–∏—è': new_students_df['late_count'],
        '–í–Ω–µ—É—á–µ–±–∫–∞': new_students_df['extracurricular'].map({1: '–î–∞', 0: '–ù–µ—Ç'}),
        '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å_—É—Å–ø–µ—Ö–∞': [f"{p:.1%}" for p in probabilities],  # ‚ö†Ô∏è –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã
        '–°—Ç–∞—Ç—É—Å': statuses
    })
    
    # –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    print("\n" + "üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê".center(80))
    print("=" * 80)
    print(results.to_string(index=False))  # ‚ö†Ô∏è –í—ã–≤–æ–¥–∏–º –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤
    print("=" * 80)
    
    # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
    if n_new > 0:
        create_visualizations(results, n_new)
    
    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    print_recommendations(results, n_new)

except ValueError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞: {e}")
except Exception as e:
    print(f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {e}")

print("\n" + "=" * 60)
print("‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω")
print("=" * 60)
